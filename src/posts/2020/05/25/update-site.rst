.. post:: 2020-05-25
   :tags: Netlify, Cookie, utteranc.es
   :category: blog

.. meta::
  :description: サイトの更新に当たっての雑多なメモ


=============================
[日記] サイトの更新(2020.05)
=============================

更新内容
==========

* 記事のコメント欄を Disqus から `utteranc.es <https://utteranc.es/>`_ に変更
* お問い合わせのリンクで GitHub Issue に強引に飛ばしていたのやめて `Netlify Forms <https://www.netlify.com/products/forms/>`_ を導入
* 記事の最後にシェア用の Tweet ボタン(リンク)とシェア用の文言をさりげなく配置

動機
======

1. このブログを Twitter でシェアしてくださった方がいて、それはありがたいことなのだが、リンクが Disqus の短縮URL になっているのに気づいた
2. よくよく見ると Disqus のコメント欄に Tweet ボタンが設置してあったので（気づいてなかった）それを利用されたのだと思われる
3. だが、この Tweet ボタンはブログ名が含まれない仕様なので **私がエゴサしにくい**
4. Disqus のフォーム設置により doubleclick.net へのアクセスが発生しているのが以前から気になっていたこともあり、別のものに変更することにした

utterances
=============

* GitHub の Issue にデータをおく形でコメント欄を設置できるサービス
* コメントするには GitHub での認可が必要になる（普通にGitHubを開いて対応するIssue にコメントすることも可能）
* utteranc.es のアプリが GitHub から取得したアクセストークンを Cookie にそのまま突っ込んでいるのが若干気になる

  * がトークンの権限が ykrods/note リポジトリの Issue の読み書き権だけなので最悪どうにかなっても大きな被害は発生しないかと思われる（もともとコメント来ないし、、）

Netlify Forms
===============

* コメントフォームの utterances の別案として調べたもの。せっかくなのでお問い合わせフォームに利用してみることにした
* Netlify の指定に従ったhtmlフォームを設置すると Netlify 側で POST データを保存してくれる。便利。
* 設定でメール通知したり、webhook 飛ばしたり色々できる。 `Netlify Function <https://www.netlify.com/products/functions/>`_ と連携させてスクリプトを実行することもできる。
* お問い合わせができるならコメントフォームは必要なくなった気がしなくも無い（コメント来ないし、、）

Tweet ボタン (リンク)
======================

* Disqus の Tweet ボタンを外したので代わりに自分で設置することにした
* 最初ははてな等色々ボタンをおくつもりだったが、軒並み script タグの通信で Cookie の送受信が行われているので面倒になり、Tweet のリンクをおくだけにした（後述）

プライバシーポリシー
======================

* サイトのプライバシーポリシーは別のサービス公開する際の下地にもなるのである程度真面目に書いている（専門家の方から見たらツッコミどころはたくさんあると思われるが）

  * :doc:`../../../../site-policy`

* このサイトは個人のもので、内容は好きに書きたいし集客努力をする気もないので GA も入れていない

  * だがサイトに外部サービスが提供しているscriptタグを埋め込む場合、サードパーティCookie が送られる可能性がある
  * 「このサイトにアクセスしたらCookieが飛ぶ」以上、サイト運営者（私）が「このCookieはこういう目的で使われていて〜」と説明する必要が（真面目にやるなら）出てくるはずだが、サードパーティのサイトで GA を入れてたなんてことになると「私はトラッキングしてないんですけど、このサイトの一部機能は外部のドメインからのスクリプトを利用していて〜そっちの方ではトラッキングしてるみたいです〜まぁなんかクッキー名とか詳しく書いてないから多分なんですけど〜あ、それとは別に純粋に機能を提供するためのCookieもあるみたいです〜これも推測ですけど〜」みたいな説明をする羽目になる
  * 最近のブラウザではこうしたトラッキング目的のCookieが自動的にブロックされる機能が入っているらしいが [1]_ 、その辺まで踏まえるとさらに話がややこしくなるのでコンテンツに必要な場合をのぞいてサードパーティのリクエスト自体をなるべく発生させないようにした

.. rubric:: Footnotes

.. [1] Safari の Intelligent Tracking Prevention, Firefox の Enhanced Tracking Protection があり、 Chrome はもはや `Third-Party Cookie をサポートしないようにする予定 <https://blog.chromium.org/2020/01/building-more-private-web-path-towards.html>`_ だそう。
